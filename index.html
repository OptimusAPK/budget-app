<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#667eea">
  <meta name="description" content="Manage shared expenses effortlessly with Anupam & Astha Budget App">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Budget App">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%23667eea' width='180' height='180' rx='40'/><text x='50%' y='50%' font-size='100' fill='white' text-anchor='middle' dy='.35em' font-family='Arial' font-weight='bold'>ğŸ’°</text></svg>">
  <title>Budget App - Shared Expenses</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23667eea' width='100' height='100' rx='20'/><text x='50%' y='50%' font-size='70' fill='white' text-anchor='middle' dy='.35em' font-family='Arial' font-weight='bold'>ğŸ’°</text></svg>">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>

<div class="app-container">
  <div class="header-section">
    <h1>ğŸ’° Budget App</h1>
    <p class="subtitle">Anupam & Astha</p>
  </div>

  <!-- LOGIN -->
  <div id="loginSection" class="card login-card">
    <h2>Welcome to Budget App</h2>
    <p class="login-desc">Manage your shared expenses effortlessly</p>
    <button class="btn-primary" onclick="loginWithGoogle()"><i class="fab fa-google"></i> Login with Google</button>
    <div class="divider">OR</div>
    <button class="btn-secondary" onclick="toggleEmail()"><i class="fas fa-envelope"></i> Login with Email</button>

    <div id="emailBox" class="email-box">
      <div class="form-group">
        <input id="email" type="email" placeholder="Email address" required>
      </div>
      <div class="form-group">
        <input id="password" type="password" placeholder="Password" required>
      </div>
      <div class="button-group">
        <button class="btn-primary" onclick="emailLogin()">Login</button>
        <button class="btn-secondary" onclick="emailSignup()">Sign Up</button>
      </div>
    </div>
    
  </div>

  <p id="userInfo" class="user-info"></p>

  <!-- APP (hidden by default) -->
  <div id="appSection" style="display:none">

    <!-- Settings Bar -->
    <div class="card settings-bar">
      <div class="settings-group">
        <label for="currencySelect">ğŸ’± Currency:</label>
        <select id="currencySelect" onchange="changeCurrency()" class="currency-select">
          <option value="INR">â‚¹ INR (Indian Rupee)</option>
          <option value="USD">$ USD (US Dollar)</option>
          <option value="EUR">â‚¬ EUR (Euro)</option>
          <option value="GBP">Â£ GBP (British Pound)</option>
          <option value="JPY">Â¥ JPY (Japanese Yen)</option>
          <option value="AUD">A$ AUD (Australian Dollar)</option>
          <option value="CAD">C$ CAD (Canadian Dollar)</option>
        </select>
      </div>
    </div>

    <!-- Budget selector + Add User -->
    <div class="card header-card">
      <div class="budget-selector-group">
        <select id="budgetSelect" class="budget-select" onchange="onBudgetChange()">
          <option disabled selected>ğŸ“Š Select a Budget</option>
        </select>
        <button class="btn-primary" onclick="showCreateBudgetForm()" title="Create a new budget">
          <i class="fas fa-plus"></i> New Budget
        </button>
        <button id="addUserBtn" class="btn-icon" onclick="toggleAddUser()" style="display:none" title="Add user to budget">
          <i class="fas fa-user-plus"></i> Add Member
        </button>
      </div>
    </div>

    <!-- Budget Members Display -->
    <div class="card members-card" id="membersDiv" style="display:none">
      <h3><i class="fas fa-users"></i> Budget Members</h3>
      <div id="membersList" class="members-list"></div>
    </div>

    <!-- Create budget (shown only when clicking Create New button) -->
    <div class="card" id="createBudgetDiv" style="display:none">
      <h3>Create New Budget</h3>
      <div class="form-group">
        <input id="newBudgetName" placeholder="Budget name (e.g., Trip to Europe)" required>
      </div>
      <div class="button-group">
        <button class="btn-primary" onclick="createBudget()"><i class="fas fa-plus"></i> Create</button>
        <button class="btn-secondary" onclick="hideBudgetForm()"><i class="fas fa-times"></i> Cancel</button>
      </div>
    </div>

    <!-- Add User interface -->
    <div class="card modal-card" id="addUserDiv" style="display:none">
      <div class="modal-header">
        <h3><i class="fas fa-user-plus"></i> Add Member to Budget</h3>
        <button class="closeBtn" onclick="toggleAddUser()"><i class="fas fa-times"></i></button>
      </div>
      <select id="usersDropdown" class="form-control">
        <option disabled selected>Select user to add</option>
      </select>
      <button class="btn-primary btn-block" onclick="addUser()"><i class="fas fa-check"></i> Add Member</button>
    </div>

    <!-- Budget Summary -->
    <div class="card" id="summaryDiv" style="display:none">
      <h3><i class="fas fa-chart-pie"></i> Budget Summary</h3>
      <div id="summaryContent" class="summary-grid"></div>
    </div>

    <!-- Add transaction -->
    <div class="card add-transaction-card" id="addTransactionDiv">
      <h3><i class="fas fa-plus-circle"></i> Add Expense</h3>
      <div class="transaction-form">
        <div class="form-group">
          <input id="desc" placeholder="What did you spend on?" required>
        </div>
        <div class="form-row">
          <div class="form-group">
            <select id="cat" class="form-control">
              <option value="">Select category</option>
              <option value="Food">ğŸ” Food</option>
              <option value="Rent">ğŸ  Rent</option>
              <option value="Travel">âœˆï¸ Travel</option>
              <option value="Entertainment">ğŸ¬ Entertainment</option>
              <option value="Utilities">ğŸ’¡ Utilities</option>
              <option value="Shopping">ğŸ›ï¸ Shopping</option>
              <option value="Other">ğŸ“Œ Other</option>
            </select>
          </div>
          <div class="form-group">
            <input id="amt" type="number" placeholder="Amount" step="0.01" min="0" required>
          </div>
          <button class="btn-primary btn-add" onclick="addTransaction()"><i class="fas fa-plus"></i></button>
        </div>
      </div>
    </div>

    <!-- Transactions Table -->
    <div class="card transactions-card">
      <div class="card-header">
        <h3 id="currentBudget"><i class="fas fa-list"></i> No Budget Selected</h3>
        <div class="transaction-count" id="txCount"></div>
      </div>
      <div id="noTransactions" class="empty-state">
        <i class="fas fa-inbox"></i>
        <p>No expenses yet. Add your first expense above!</p>
      </div>
      <table id="transactionsTable" style="display:none">
        <thead>
          <tr>
            <th>Description</th>
            <th>Category</th>
            <th>Amount</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="transactions"></tbody>
      </table>
    </div>

    <button class="btn-logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>

  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="script.js"></script>

<!-- Service Worker Registration -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('service-worker.js')
        .then(registration => {
          console.log('ServiceWorker registration successful:', registration.scope);
        })
        .catch(err => {
          console.log('ServiceWorker registration failed: ', err);
        });
    });

    // Check for updates periodically
    setInterval(() => {
      navigator.serviceWorker.getRegistrations().then(registrations => {
        registrations.forEach(registration => {
          registration.update();
        });
      });
    }, 60000); // Check every 60 seconds
  }

  // Add to home screen prompt handling
  let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    console.log('Install prompt available');
  });
</script>
</body>
</html>
<script src="script.js"></script>
</body>
</html>
